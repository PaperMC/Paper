From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: david <mrminecraft00@gmail.com>
Date: Sun, 16 Mar 2025 16:58:43 +0100
Subject: [PATCH] Improve visual fire API in Entity class


diff --git a/net/minecraft/world/entity/Entity.java b/net/minecraft/world/entity/Entity.java
index b2b61203438bb1fad1ee807729781718d2467155..741f3b6bce93eb497f963583cc37906022539896 100644
--- a/net/minecraft/world/entity/Entity.java
+++ b/net/minecraft/world/entity/Entity.java
@@ -303,7 +303,7 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
     private boolean onGroundNoBlocks = false;
     private float crystalSoundIntensity;
     private int lastCrystalSoundPlayTick;
-    public boolean hasVisualFire;
+    public net.kyori.adventure.util.TriState visualFire; // Paper - improve visual fire API
     @Nullable
     private BlockState inBlockState = null;
     private final List<Entity.Movement> movementThisTick = new ArrayList<>();
@@ -895,7 +895,7 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
     }
 
     public void setSharedFlagOnFire(boolean isOnFire) {
-        this.setSharedFlag(0, isOnFire || this.hasVisualFire);
+        this.setSharedFlag(0, this.visualFire.toBooleanOrElse(isOnFire)); // Paper - improve visual fire API
     }
 
     public void checkBelowWorld() {
@@ -2465,9 +2465,11 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
                 compound.putInt("TicksFrozen", this.getTicksFrozen());
             }
 
-            if (this.hasVisualFire) {
-                compound.putBoolean("HasVisualFire", this.hasVisualFire);
+            // Paper start - improve visual fire API
+            if (!this.visualFire.equals(net.kyori.adventure.util.TriState.NOT_SET)) {
+                compound.putBoolean("HasVisualFire", this.visualFire.equals(net.kyori.adventure.util.TriState.TRUE));
             }
+            // Paper end
 
             if (!this.tags.isEmpty()) {
                 ListTag listTag = new ListTag();
@@ -2590,7 +2592,11 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
                 this.setNoGravity(compound.getBoolean("NoGravity"));
                 this.setGlowingTag(compound.getBoolean("Glowing"));
                 this.setTicksFrozen(compound.getInt("TicksFrozen"));
-                this.hasVisualFire = compound.getBoolean("HasVisualFire");
+                 // Paper start - improve visual fire API
+                this.visualFire = compound.contains("HasVisualFire")
+                    ? net.kyori.adventure.util.TriState.byBoolean(compound.getBoolean("HasVisualFire"))
+                    : net.kyori.adventure.util.TriState.NOT_SET;
+                // Paper end
                 if (compound.contains("Tags", 9)) {
                     this.tags.clear();
                     ListTag list3 = compound.getList("Tags", 8);
