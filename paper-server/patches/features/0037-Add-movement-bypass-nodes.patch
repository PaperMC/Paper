From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mickey42302 <bgoodwin423@gmail.com>
Date: Mon, 10 Nov 2025 20:53:27 -0500
Subject: [PATCH] Add movement bypass nodes


diff --git a/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 092261baeff155d18026074bf1f9db17bcb20431..89bd3a39f410215f773de79238bebb77e81196ec 100644
--- a/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -598,6 +598,9 @@ public class ServerGamePacketListenerImpl
                 // Paper end - Prevent moving into unloaded chunks
                 if (d7 - d6 > Math.max(100.0, Mth.square(org.spigotmc.SpigotConfig.movedTooQuicklyMultiplier * (float) i * speed)) && !this.isSingleplayerOwner()) {
                     // CraftBukkit end
+                    if (this.player.getBukkitEntity().hasPermission("minecraft.movement.bypass.vehicle")) {
+                        return;
+                    }
                     LOGGER.warn("{} (vehicle of {}) moved too quickly! {},{},{}", rootVehicle.getPlainTextName(), this.player.getPlainTextName(), d3, d4, d5);
                     this.send(ClientboundMoveVehiclePacket.fromEntity(rootVehicle));
                     return;
@@ -626,6 +629,9 @@ public class ServerGamePacketListenerImpl
                 boolean flag1 = false;
                 if (d7 > org.spigotmc.SpigotConfig.movedWronglyThreshold) { // Spigot
                     flag1 = true; // Paper - diff on change, this should be moved wrongly
+                    if (this.player.getBukkitEntity().hasPermission("minecraft.movement.bypass.vehicle")) {
+                        return;
+                    }
                     LOGGER.warn("{} (vehicle of {}) moved wrongly! {}", rootVehicle.getPlainTextName(), this.player.getPlainTextName(), Math.sqrt(d7));
                 }
 
@@ -1502,6 +1508,9 @@ public class ServerGamePacketListenerImpl
                                         float f2 = isFallFlying ? 300.0F : 100.0F;
                                         if (d7 - d6 > Math.max(f2, Mth.square(org.spigotmc.SpigotConfig.movedTooQuicklyMultiplier * (float) i * speed))) {
                                             // CraftBukkit end
+                                            if (this.player.getBukkitEntity().hasPermission("minecraft.movement.bypass.client")) {
+                                                return;
+                                            }
                                             // Paper start - Add fail move event
                                             io.papermc.paper.event.player.PlayerFailMoveEvent event = fireFailMove(io.papermc.paper.event.player.PlayerFailMoveEvent.FailReason.MOVED_TOO_QUICKLY,
                                                     toX, toY, toZ, toYaw, toPitch, true);
@@ -1578,7 +1587,8 @@ public class ServerGamePacketListenerImpl
                                     && d7 > org.spigotmc.SpigotConfig.movedWronglyThreshold // Spigot
                                     && !this.player.isSleeping()
                                     && !this.player.isCreative()
-                                    && !this.player.isSpectator()) {
+                                    && !this.player.isSpectator()
+                                    && !this.player.getBukkitEntity().hasPermission("minecraft.movement.bypass.client")) {
                                     // Paper start - Add fail move event
                                     io.papermc.paper.event.player.PlayerFailMoveEvent event = fireFailMove(io.papermc.paper.event.player.PlayerFailMoveEvent.FailReason.MOVED_WRONGLY,
                                             toX, toY, toZ, toYaw, toPitch, true);
@@ -1729,6 +1739,8 @@ public class ServerGamePacketListenerImpl
             return false;
         } else if (this.player.isChangingDimension()) {
             return false;
+        } else if (this.player.getBukkitEntity().hasPermission("minecraft.movement.bypass.elytra")) {
+            return false;
         } else {
             GameRules gameRules = this.player.level().getGameRules();
             return !gameRules.getBoolean(GameRules.RULE_DISABLE_PLAYER_MOVEMENT_CHECK)
