From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/server/commands/ReloadCommand.java b/net/minecraft/server/commands/ReloadCommand.java
index 868993e831cd837c64bb68008fa12e56dcefe859..fcca0babb4e7929cc168fc8b9ad47619e6feb1a5 100644
--- a/net/minecraft/server/commands/ReloadCommand.java
+++ b/net/minecraft/server/commands/ReloadCommand.java
@@ -16,7 +16,7 @@ public class ReloadCommand {
     private static final Logger LOGGER = LogUtils.getLogger();
 
     public static void reloadPacks(Collection<String> selectedIds, CommandSourceStack source) {
-        source.getServer().reloadResources(selectedIds).exceptionally(throwable -> {
+        source.getServer().reloadResources(selectedIds, io.papermc.paper.event.server.ServerResourcesReloadedEvent.Cause.COMMAND).exceptionally(throwable -> { // Paper - Add ServerResourcesReloadedEvent
             LOGGER.warn("Failed to execute reload", throwable);
             source.sendFailure(Component.translatable("commands.reload.failure"));
             return null;
@@ -24,7 +24,7 @@ public class ReloadCommand {
     }
 
     private static Collection<String> discoverNewPacks(PackRepository packRepository, WorldData worldData, Collection<String> selectedIds) {
-        packRepository.reload();
+        packRepository.reload(true); // Paper - will perform a full reload
         Collection<String> list = Lists.newArrayList(selectedIds);
         Collection<String> disabled = worldData.getDataConfiguration().dataPacks().getDisabled();
 
@@ -37,6 +37,16 @@ public class ReloadCommand {
         return list;
     }
 
+    // CraftBukkit start
+    public static void reload(MinecraftServer server) {
+        PackRepository packRepository = server.getPackRepository();
+        WorldData worldData = server.getWorldData();
+        Collection<String> selectedIds = packRepository.getSelectedIds();
+        Collection<String> collection = discoverNewPacks(packRepository, worldData, selectedIds);
+        server.reloadResources(collection, io.papermc.paper.event.server.ServerResourcesReloadedEvent.Cause.PLUGIN); // Paper - Add ServerResourcesReloadedEvent
+    }
+    // CraftBukkit end
+
     public static void register(CommandDispatcher<CommandSourceStack> dispatcher) {
         dispatcher.register(Commands.literal("reload").requires(Commands.hasPermission(Commands.LEVEL_GAMEMASTERS)).executes(commandContext -> {
             CommandSourceStack commandSourceStack = commandContext.getSource();
