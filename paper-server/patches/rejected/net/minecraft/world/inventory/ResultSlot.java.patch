From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/inventory/ResultSlot.java b/net/minecraft/world/inventory/ResultSlot.java
index 95f291d37dbf2c2f1461824122fa6a76e40285eb..32e2ee436578e8f35d1cbadf3eee31a8bee1404b 100644
--- a/net/minecraft/world/inventory/ResultSlot.java
+++ b/net/minecraft/world/inventory/ResultSlot.java
@@ -39,6 +39,11 @@ public class ResultSlot extends Slot {
     protected void onQuickCraft(ItemStack stack, int amount) {
         this.removeCount += amount;
         this.checkTakeAchievements(stack);
+        // Paper start - add ItemCraftedEvent
+        if (!stack.isEmpty()) {
+            new io.papermc.paper.event.inventory.ItemCraftedEvent((org.bukkit.entity.Player) this.player.getBukkitEntity(), org.bukkit.craftbukkit.inventory.CraftItemStack.asBukkitCopy(stack)).callEvent();
+        }
+        // Paper end - add ItemCraftedEvent
     }
 
     @Override
@@ -72,7 +77,7 @@ public class ResultSlot extends Slot {
     private NonNullList<ItemStack> getRemainingItems(CraftingInput input, Level level) {
         return level instanceof ServerLevel serverLevel
             ? serverLevel.recipeAccess()
-                .getRecipeFor(RecipeType.CRAFTING, input, serverLevel)
+                .getRecipeFor(RecipeType.CRAFTING, input, serverLevel, this.craftSlots.getCurrentRecipe()) // Paper - Perf: Improve mass crafting; check last recipe used first
                 .map(recipe -> recipe.value().getRemainingItems(input))
                 .orElseGet(() -> copyAllInputItems(input))
             : CraftingRecipe.defaultCraftingReminder(input);
@@ -80,6 +85,11 @@ public class ResultSlot extends Slot {
 
     @Override
     public void onTake(Player player, ItemStack stack) {
+        // Paper start - add ItemCraftedEvent
+        if (!stack.isEmpty()) {
+            new io.papermc.paper.event.inventory.ItemCraftedEvent((org.bukkit.entity.Player) player.getBukkitEntity(), org.bukkit.craftbukkit.inventory.CraftItemStack.asBukkitCopy(stack)).callEvent();
+        }
+        // Paper end - add ItemCraftedEvent
         this.checkTakeAchievements(stack);
         CraftingInput.Positioned positionedCraftInput = this.craftSlots.asPositionedCraftInput();
         CraftingInput craftingInput = positionedCraftInput.input();
