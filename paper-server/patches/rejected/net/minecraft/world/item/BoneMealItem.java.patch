From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/item/BoneMealItem.java b/net/minecraft/world/item/BoneMealItem.java
index b50f0d40705b180a421ec03a344481e98b96abfd..4490e50f02d2c7383e86951cb98a113d5d4f36c2 100644
--- a/net/minecraft/world/item/BoneMealItem.java
+++ b/net/minecraft/world/item/BoneMealItem.java
@@ -35,13 +35,18 @@ public class BoneMealItem extends Item {
 
     @Override
     public InteractionResult useOn(UseOnContext context) {
+        // CraftBukkit start - extract bonemeal application logic to separate, static method
+        return BoneMealItem.applyBonemeal(context);
+    }
+    public static InteractionResult applyBonemeal(UseOnContext context) {
+        // CraftBukkit end
         Level level = context.getLevel();
         BlockPos clickedPos = context.getClickedPos();
         BlockPos blockPos = clickedPos.relative(context.getClickedFace());
         ItemStack itemInHand = context.getItemInHand();
         if (growCrop(itemInHand, level, clickedPos)) {
             if (!level.isClientSide()) {
-                itemInHand.causeUseVibration(context.getPlayer(), GameEvent.ITEM_INTERACT_FINISH);
+                if (context.getPlayer() != null) itemInHand.causeUseVibration(context.getPlayer(), GameEvent.ITEM_INTERACT_FINISH); // CraftBukkit - SPIGOT-7518
                 level.levelEvent(LevelEvent.PARTICLES_AND_SOUND_PLANT_GROWTH, clickedPos, 15);
             }
 
@@ -51,7 +56,7 @@ public class BoneMealItem extends Item {
             boolean isFaceSturdy = blockState.isFaceSturdy(level, clickedPos, context.getClickedFace());
             if (isFaceSturdy && growWaterPlant(itemInHand, level, blockPos, context.getClickedFace())) {
                 if (!level.isClientSide()) {
-                    itemInHand.causeUseVibration(context.getPlayer(), GameEvent.ITEM_INTERACT_FINISH);
+                    if (context.getPlayer() != null) itemInHand.causeUseVibration(context.getPlayer(), GameEvent.ITEM_INTERACT_FINISH); // CraftBukkit - SPIGOT-7518
                     level.levelEvent(LevelEvent.PARTICLES_AND_SOUND_PLANT_GROWTH, blockPos, 15);
                 }
 
