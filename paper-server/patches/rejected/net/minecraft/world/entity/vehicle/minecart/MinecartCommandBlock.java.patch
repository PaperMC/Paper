From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/entity/vehicle/minecart/MinecartCommandBlock.java b/net/minecraft/world/entity/vehicle/minecart/MinecartCommandBlock.java
index 177eef703079506db0038bc90081d900521019b9..21e14ff87fb90541437c4c33e1def56c67e6a939 100644
--- a/net/minecraft/world/entity/vehicle/minecart/MinecartCommandBlock.java
+++ b/net/minecraft/world/entity/vehicle/minecart/MinecartCommandBlock.java
@@ -84,7 +84,7 @@ public class MinecartCommandBlock extends AbstractMinecart {
 
     @Override
     public InteractionResult interact(Player player, InteractionHand hand) {
-        if (!player.canUseGameMasterBlocks()) {
+        if (!player.canUseGameMasterBlocks() && (!player.isCreative() || !player.getBukkitEntity().hasPermission("minecraft.commandblock"))) { // Paper - command block permission
             return InteractionResult.PASS;
         } else {
             if (player.level().isClientSide()) {
@@ -122,7 +122,7 @@ public class MinecartCommandBlock extends AbstractMinecart {
                 MinecartCommandBlock.this.position(),
                 MinecartCommandBlock.this.getRotationVector(),
                 level,
-                LevelBasedPermissionSet.GAMEMASTER,
+                LevelBasedPermissionSet.forLevel(net.minecraft.server.permissions.PermissionLevel.byId(level.paperConfig().commandBlocks.permissionsLevel)), // Paper - configurable command block perm level
                 this.getName().getString(),
                 MinecartCommandBlock.this.getDisplayName(),
                 level.getServer(),
@@ -134,5 +134,17 @@ public class MinecartCommandBlock extends AbstractMinecart {
         public boolean isValid() {
             return !MinecartCommandBlock.this.isRemoved();
         }
+
+        // CraftBukkit start
+        @Override
+        public org.bukkit.command.CommandSender getBukkitSender(CommandSourceStack wrapper) {
+            return net.minecraft.world.entity.vehicle.minecart.MinecartCommandBlock.this.getBukkitEntity();
+        }
+
+        @Override
+        public net.minecraft.server.level.ServerLevel getLevel() {
+            return (net.minecraft.server.level.ServerLevel) MinecartCommandBlock.this.level();
+        }
+        // CraftBukkit end
     }
 }
