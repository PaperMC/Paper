From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/level/block/entity/CommandBlockEntity.java b/net/minecraft/world/level/block/entity/CommandBlockEntity.java
index 3d5857de9f65a8401508d9675bcb5335c314164c..01b20c1aba5f85c506ceb0678c1372bece291d2b 100644
--- a/net/minecraft/world/level/block/entity/CommandBlockEntity.java
+++ b/net/minecraft/world/level/block/entity/CommandBlockEntity.java
@@ -27,6 +27,18 @@ public class CommandBlockEntity extends BlockEntity {
     private boolean auto = false;
     private boolean conditionMet = false;
     private final BaseCommandBlock commandBlock = new BaseCommandBlock() {
+        // CraftBukkit start
+        @Override
+        public org.bukkit.command.CommandSender getBukkitSender(CommandSourceStack wrapper) {
+            return new org.bukkit.craftbukkit.command.CraftBlockCommandSender(wrapper, CommandBlockEntity.this);
+        }
+
+        @Override
+        public net.minecraft.server.level.ServerLevel getLevel() {
+            return (net.minecraft.server.level.ServerLevel) CommandBlockEntity.this.getLevel();
+        }
+        // CraftBukkit end
+
         @Override
         public void setCommand(String command) {
             super.setCommand(command);
@@ -47,7 +59,7 @@ public class CommandBlockEntity extends BlockEntity {
                 Vec3.atCenterOf(CommandBlockEntity.this.worldPosition),
                 new Vec2(0.0F, direction.toYRot()),
                 level,
-                LevelBasedPermissionSet.GAMEMASTER,
+                LevelBasedPermissionSet.forLevel(net.minecraft.server.permissions.PermissionLevel.byId(level.paperConfig().commandBlocks.permissionsLevel)), // Paper - configurable command block perm level
                 this.getName().getString(),
                 this.getName(),
                 level.getServer(),
