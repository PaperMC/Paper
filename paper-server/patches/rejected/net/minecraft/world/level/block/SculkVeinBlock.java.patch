From c8366d72279d30331daff185f7b263159a86ff4d Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 06:37:42 -0700
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/world/level/block/SculkVeinBlock.java b/net/minecraft/world/level/block/SculkVeinBlock.java
index 6b06ce435cd2b48b6d4a4d902047d4885eaf6bae..eabae481fbf298d4d3a2d82bd265aadd6dddf68f 100644
--- a/net/minecraft/world/level/block/SculkVeinBlock.java
+++ b/net/minecraft/world/level/block/SculkVeinBlock.java
@@ -90,14 +90,14 @@ public class SculkVeinBlock extends MultifaceSpreadeableBlock implements SculkBe
     public int attemptUseCharge(
         SculkSpreader.ChargeCursor cursor, LevelAccessor level, BlockPos pos, RandomSource random, SculkSpreader spreader, boolean shouldConvertBlocks
     ) {
-        if (shouldConvertBlocks && this.attemptPlaceSculk(spreader, level, cursor.getPos(), random)) {
+        if (shouldConvertBlocks && this.attemptPlaceSculk(spreader, level, cursor.getPos(), random, pos)) { // CraftBukkit - add source block
             return cursor.getCharge() - 1;
         } else {
             return random.nextInt(spreader.chargeDecayRate()) == 0 ? Mth.floor(cursor.getCharge() * 0.5F) : cursor.getCharge();
         }
     }
 
-    private boolean attemptPlaceSculk(SculkSpreader spreader, LevelAccessor level, BlockPos pos, RandomSource random) {
+    private boolean attemptPlaceSculk(SculkSpreader spreader, LevelAccessor level, BlockPos pos, RandomSource random, BlockPos sourceBlock) { // CraftBukkit
         BlockState blockState = level.getBlockState(pos);
         TagKey<Block> tagKey = spreader.replaceableBlocks();
 
@@ -107,7 +107,11 @@ public class SculkVeinBlock extends MultifaceSpreadeableBlock implements SculkBe
                 BlockState blockState1 = level.getBlockState(blockPos);
                 if (blockState1.is(tagKey)) {
                     BlockState blockState2 = Blocks.SCULK.defaultBlockState();
-                    level.setBlock(blockPos, blockState2, Block.UPDATE_ALL);
+                    // CraftBukkit start - Call BlockSpreadEvent
+                    if (!org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockSpreadEvent(level, sourceBlock, blockPos, blockState2, Block.UPDATE_ALL)) {
+                        return false;
+                    }
+                    // CraftBukkit end
                     Block.pushEntitiesUp(blockState1, blockState2, level, blockPos);
                     level.playSound(null, blockPos, SoundEvents.SCULK_BLOCK_SPREAD, SoundSource.BLOCKS, 1.0F, 1.0F);
                     this.veinSpreader.spreadAll(blockState2, level, blockPos, spreader.isWorldGeneration());
