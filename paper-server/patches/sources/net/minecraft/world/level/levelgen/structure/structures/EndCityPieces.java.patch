--- a/net/minecraft/world/level/levelgen/structure/structures/EndCityPieces.java
+++ b/net/minecraft/world/level/levelgen/structure/structures/EndCityPieces.java
@@ -410,7 +_,10 @@
             if (markerId.startsWith("Chest")) {
                 BlockPos chestPosition = position.below();
                 if (chunkBB.isInside(chestPosition)) {
-                    RandomizableContainer.setBlockEntityLootTable(level, random, chestPosition, BuiltInLootTables.END_CITY_TREASURE);
+                    // CraftBukkit start - ensure block transformation
+                    // RandomizableContainer.setBlockEntityLootTable(level, random, chestPosition, BuiltInLootTables.END_CITY_TREASURE);
+                    this.setCraftLootTable(level, chestPosition, random, BuiltInLootTables.END_CITY_TREASURE);
+                    // CraftBukkit end
                 }
             } else if (chunkBB.isInside(position) && Level.isInSpawnableBounds(position)) {
                 if (markerId.startsWith("Sentry")) {
