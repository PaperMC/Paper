--- a/net/minecraft/world/level/BaseCommandBlock.java
+++ b/net/minecraft/world/level/BaseCommandBlock.java
@@ -31,6 +_,10 @@
     private String command = "";
     @Nullable
     private Component customName;
+    // CraftBukkit start
+    protected abstract org.bukkit.command.CommandSender getBukkitSender(CommandSourceStack wrapper);
+    public abstract ServerLevel getLevel();
+    // CraftBukkit end
 
     public int getSuccessCount() {
         return this.successCount;
@@ -107,7 +_,13 @@
                                 this.successCount++;
                             }
                         });
-                        level.getServer().getCommands().performPrefixedCommand(commandSourceStack, this.command);
+                        // Paper start - ServerCommandEvent
+                        org.bukkit.event.server.ServerCommandEvent event = new org.bukkit.event.server.ServerCommandEvent(commandSourceStack.getBukkitSender(), net.minecraft.commands.Commands.trimOptionalPrefix(this.command));
+                        if (!event.callEvent()) {
+                            return true;
+                        }
+                        level.getServer().getCommands().performPrefixedCommand(commandSourceStack, event.getCommand());
+                        // Paper end - ServerCommandEvent
                     }
                 } catch (Throwable var7) {
                     CrashReport crashReport = CrashReport.forThrowable(var7, "Executing command block");
@@ -164,12 +_,12 @@
 
     public abstract boolean isValid();
 
-    protected class CloseableCommandBlockSource implements CommandSource, AutoCloseable {
+    public class CloseableCommandBlockSource implements CommandSource, AutoCloseable { // Paper - public
         private final ServerLevel level;
         private static final DateTimeFormatter TIME_FORMAT = DateTimeFormatter.ofPattern("HH:mm:ss", Locale.ROOT);
         private boolean closed;
 
-        protected CloseableCommandBlockSource(final ServerLevel level) {
+        public CloseableCommandBlockSource(final ServerLevel level) { // Paper - public
             this.level = level;
         }
 
@@ -191,6 +_,7 @@
         @Override
         public void sendSystemMessage(Component message) {
             if (!this.closed) {
+                org.spigotmc.AsyncCatcher.catchOp("sendSystemMessage to a command block"); // Paper - Don't broadcast messages to command blocks
                 BaseCommandBlock.this.lastOutput = Component.literal("[" + TIME_FORMAT.format(ZonedDateTime.now()) + "] ").append(message);
                 BaseCommandBlock.this.onUpdated(this.level);
             }
@@ -200,5 +_,12 @@
         public void close() throws Exception {
             this.closed = true;
         }
+
+        // CraftBukkit start
+        @Override
+        public org.bukkit.command.CommandSender getBukkitSender(CommandSourceStack wrapper) {
+            return BaseCommandBlock.this.getBukkitSender(wrapper);
+        }
+        // CraftBukkit end
     }
 }
