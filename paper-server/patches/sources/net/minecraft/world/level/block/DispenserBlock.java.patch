--- a/net/minecraft/world/level/block/DispenserBlock.java
+++ b/net/minecraft/world/level/block/DispenserBlock.java
@@ -75,8 +_,7 @@
     protected InteractionResult useWithoutItem(
         final BlockState state, final Level level, final BlockPos pos, final Player player, final BlockHitResult hitResult
     ) {
-        if (!level.isClientSide() && level.getBlockEntity(pos) instanceof DispenserBlockEntity dispenser) {
-            player.openMenu(dispenser);
+        if (!level.isClientSide() && level.getBlockEntity(pos) instanceof DispenserBlockEntity dispenser && player.openMenu(dispenser).isPresent()) { // Paper - Fix InventoryOpenEvent cancellation
             player.awardStat(dispenser instanceof DropperBlockEntity ? Stats.INSPECT_DROPPER : Stats.INSPECT_DISPENSER);
         }
 
@@ -91,17 +_,26 @@
             BlockSource source = new BlockSource(level, pos, state, blockEntity);
             int slot = blockEntity.getRandomSlot(level.getRandom());
             if (slot < 0) {
+                if (org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockFailedDispenseEvent(level, pos)) { // Paper - Add BlockFailedDispenseEvent
                 level.levelEvent(LevelEvent.SOUND_DISPENSER_FAIL, pos, 0);
                 level.gameEvent(GameEvent.BLOCK_ACTIVATE, pos, GameEvent.Context.of(blockEntity.getBlockState()));
+                } // Paper - Add BlockFailedDispenseEvent
             } else {
                 ItemStack itemStack = blockEntity.getItem(slot);
                 DispenseItemBehavior behavior = this.getDispenseMethod(level, itemStack);
                 if (behavior != DispenseItemBehavior.NOOP) {
+                    if (!org.bukkit.craftbukkit.event.CraftEventFactory.handleBlockPreDispenseEvent(level, pos, itemStack, slot)) return; // Paper - Add BlockPreDispenseEvent
                     blockEntity.setItem(slot, behavior.dispense(source, itemStack));
                 }
             }
         }
     }
+
+    // Paper start - Fix NPE with equippable and items without behavior
+    public static DispenseItemBehavior getDispenseBehavior(BlockSource pointer, ItemStack stack) {
+        return ((DispenserBlock) pointer.state().getBlock()).getDispenseMethod(pointer.level(), stack);
+    }
+    // Paper end - Fix NPE with equippable and items without behavior
 
     protected DispenseItemBehavior getDispenseMethod(final Level level, final ItemStack itemStack) {
         if (!itemStack.isItemEnabled(level.enabledFeatures())) {
