--- a/net/minecraft/nbt/NbtIo.java
+++ b/net/minecraft/nbt/NbtIo.java
@@ -118,6 +_,11 @@
     }
 
     public static CompoundTag read(final DataInput input, final NbtAccounter accounter) throws IOException {
+        // Spigot start
+        if (input instanceof io.netty.buffer.ByteBufInputStream byteBufInputStream) {
+            input = new DataInputStream(new org.spigotmc.LimitStream(byteBufInputStream, accounter));
+        }
+        // Spigot end
         Tag tag = readUnnamedTag(input, accounter);
         if (tag instanceof CompoundTag) {
             return (CompoundTag)tag;
