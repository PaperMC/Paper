From 3aeeaf31b7a7f888f54e47826e8ec0ddbe65c4bf Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 14:37:42 +0100
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/server/commands/DifficultyCommand.java b/net/minecraft/server/commands/DifficultyCommand.java
index 9db347097b9c98688d86ac89a28a9b724c1e9e33..4d537bd7d650518f8bf1bc7dae185d8018fac28e 100644
--- a/net/minecraft/server/commands/DifficultyCommand.java
+++ b/net/minecraft/server/commands/DifficultyCommand.java
@@ -31,10 +31,10 @@ public class DifficultyCommand {
 
     public static int setDifficulty(CommandSourceStack source, Difficulty difficulty) throws CommandSyntaxException {
         MinecraftServer server = source.getServer();
-        if (server.getWorldData().getDifficulty() == difficulty) {
+        if (source.getLevel().getDifficulty() == difficulty) { // CraftBukkit
             throw ERROR_ALREADY_DIFFICULT.create(difficulty.getKey());
         } else {
-            server.setDifficulty(difficulty, true);
+            server.setDifficulty(source.getLevel(), difficulty, true); // Paper - per level difficulty; don't skip other difficulty-changing logic (fix upstream's fix)
             source.sendSuccess(() -> Component.translatable("commands.difficulty.success", difficulty.getDisplayName()), true);
             return 0;
         }
