From 6a0255d07a09045c7b0d3db3fa88ccfd06092226 Mon Sep 17 00:00:00 2001
From: File <noreply+automated@papermc.io>
Date: Sun, 20 Apr 1997 14:37:42 +0100
Subject: [PATCH] paper File Patches


diff --git a/net/minecraft/server/players/BanListEntry.java b/net/minecraft/server/players/BanListEntry.java
index 0060b8c6493936d90b0aa42f4d23bd56ad5ae63b..e111adec2116f922fe67ee434635e50c60dad15c 100644
--- a/net/minecraft/server/players/BanListEntry.java
+++ b/net/minecraft/server/players/BanListEntry.java
@@ -26,7 +26,7 @@ public abstract class BanListEntry<T> extends StoredUserEntry<T> {
     }
 
     protected BanListEntry(@Nullable T user, JsonObject entryData) {
-        super(user);
+        super(BanListEntry.checkExpiry(user, entryData)); // CraftBukkit
 
         Date date;
         try {
@@ -80,4 +80,22 @@ public abstract class BanListEntry<T> extends StoredUserEntry<T> {
         data.addProperty("expires", this.expires == null ? "forever" : DATE_FORMAT.format(this.expires));
         data.addProperty("reason", this.reason);
     }
+
+    // CraftBukkit start
+    private static <T> T checkExpiry(T object, JsonObject jsonobject) {
+        Date expires = null;
+
+        try {
+            expires = jsonobject.has("expires") ? BanListEntry.DATE_FORMAT.parse(jsonobject.get("expires").getAsString()) : null;
+        } catch (ParseException ex) {
+            // Guess we don't have a date
+        }
+
+        if (expires == null || expires.after(new Date())) {
+            return object;
+        } else {
+            return null;
+        }
+    }
+    // CraftBukkit end
 }
