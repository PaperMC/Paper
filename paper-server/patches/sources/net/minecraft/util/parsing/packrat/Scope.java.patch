--- a/net/minecraft/util/parsing/packrat/Scope.java
+++ b/net/minecraft/util/parsing/packrat/Scope.java
@@ -279,4 +_,31 @@
 
         return true;
     }
+
+    // Paper start - track depth
+    private int depth;
+
+    private static final Term<?> INCREASING_DEPTH_TERM = (parseState, scope, control) -> {
+        if (++scope.depth > 512) {
+            parseState.errorCollector().store(parseState.mark(), new IllegalStateException("Too deep"));
+            return false;
+        }
+        return true;
+    };
+
+    @SuppressWarnings({"unchecked"})
+    public static <S> Term<S> increaseDepth() {
+        return (Term<S>) INCREASING_DEPTH_TERM;
+    }
+
+    private static final Term<?> DECREASING_DEPTH_TERM = (parseState, scope, control) -> {
+        scope.depth--;
+        return true;
+    };
+
+    @SuppressWarnings({"unchecked"})
+    public static <S> Term<S> decreaseDepth() {
+        return (Term<S>) DECREASING_DEPTH_TERM;
+    }
+    // Paper end - track depth
 }
