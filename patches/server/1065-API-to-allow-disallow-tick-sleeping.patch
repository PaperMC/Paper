From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Abel <abelvanhulst@gmail.com>
Date: Tue, 12 Nov 2024 22:25:20 +0100
Subject: [PATCH] API to allow/disallow tick sleeping


diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 64b56abf8900d0424100da460fc68ac964394793..28b969c241a4d3c8712c7d463ac43f793f09d94b 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -307,6 +307,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
     private static final AtomicReference<RuntimeException> fatalException = new AtomicReference();
     private final SuppressedExceptionCollector suppressedExceptions;
     private final DiscontinuousFrame tickFrame;
+    private static boolean allowPausing = true; // Paper - API to allow/disallow tick sleeping
 
     // CraftBukkit start
     public final WorldLoader.DataLoadContext worldLoader;
@@ -1632,7 +1633,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
 
             if (this.emptyTicks >= j) {
                 this.server.spark.tickStart(); // Paper - spark
-                if (this.emptyTicks == j) {
+                if (this.emptyTicks == j && allowPausing) { // Paper - API to allow/disallow tick sleeping
                     MinecraftServer.LOGGER.info("Server empty for {} seconds, pausing", this.pauseWhileEmptySeconds());
                     this.autoSave();
                 }
@@ -3186,4 +3187,11 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
         }
     }
     // Paper end - Add tick times API and /mspt command
+
+    // Paper start - API to allow/disallow tick sleeping
+    public static void allowPausing(boolean value) {
+        allowPausing = value;
+    }
+    // Paper end - API to allow/disallow tick sleeping
+
 }
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index dfddcfb1fe1679adaecf75375757dca720e76ce1..a8e0be7944cedbad3dd1bae4cb20a93878fb8aea 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -3246,4 +3246,12 @@ public final class CraftServer implements Server {
         return this.potionBrewer;
     }
     // Paper end
+
+    // Paper start - API to allow/disallow tick sleeping
+    @Override
+    public void allowSleeping(final boolean value) {
+        MinecraftServer.allowPausing(value);
+    }
+    // Paper end - API to allow/disallow tick sleeping
+
 }
