From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Bjarne Koll <lynxplay101@gmail.com>
Date: Mon, 15 Jul 2024 15:25:15 +0200
Subject: [PATCH] Add CrafterCraftItemEvent

Adds an event fired when the crafter crafts an item.
The event only exposes the recipe and the potential result
for event modifications.

The patch may be expanded in the future for more crafter related
event calls.

diff --git a/src/main/java/net/minecraft/world/level/block/CrafterBlock.java b/src/main/java/net/minecraft/world/level/block/CrafterBlock.java
index 6c24b25a7c8ce6e34aceb5702f1a0a6732ebca44..e05f69884ace9150a39e9347903e4985435c2203 100644
--- a/src/main/java/net/minecraft/world/level/block/CrafterBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/CrafterBlock.java
@@ -166,6 +166,15 @@ public class CrafterBlock extends BaseEntityBlock {
                 if (itemStack.isEmpty()) {
                     world.levelEvent(1050, pos, 0);
                 } else {
+                    // Paper start - add CrafterCraftEvent - fire event
+                    final io.papermc.paper.event.block.CrafterCraftEvent event = new io.papermc.paper.event.block.CrafterCraftEvent(
+                        org.bukkit.craftbukkit.block.CraftBlock.at(world, pos), recipeHolder.toBukkitRecipe(), org.bukkit.craftbukkit.inventory.CraftItemStack.asBukkitCopy(itemStack)
+                    );
+                    if (!event.callEvent()) return;
+
+                    itemStack  = org.bukkit.craftbukkit.inventory.CraftItemStack.unwrap(event.getResult());
+                    // Paper end - add CrafterCraftEvent - fire event
+
                     crafterBlockEntity.setCraftingTicksRemaining(6);
                     world.setBlock(pos, state.setValue(CRAFTING, Boolean.valueOf(true)), 2);
                     itemStack.onCraftedBySystem(world);
