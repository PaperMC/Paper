From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ammo <ammo@slne.dev>
Date: Thu, 5 Dec 2024 19:46:42 +0100
Subject: [PATCH] Add ServerChangeMaxPlayerSlotsEvent


diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index 97b5d6ba2b19a7c730730c74175a29157aed1840..48807d397cd1efd4bebf2a6a4f8a2a9e63215dce 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -773,7 +773,13 @@ public final class CraftServer implements Server {
     public void setMaxPlayers(int maxPlayers) {
         Preconditions.checkArgument(maxPlayers >= 0, "maxPlayers must be >= 0");
 
-        this.playerList.maxPlayers = maxPlayers;
+        // Paper start - Add ServerChangeMaxPlayerSlotsEvent
+        io.papermc.paper.event.server.ServerChangeMaxPlayerSlotsEvent event = new io.papermc.paper.event.server.ServerChangeMaxPlayerSlotsEvent(this.getMaxPlayers(), maxPlayers);
+        if(event.callEvent()) {
+            this.playerList.maxPlayers = event.getNewMaxPlayers();
+        }
+        // this.playerList.maxPlayers = maxPlayers;
+        // Paper end
     }
 
     // NOTE: These are dependent on the corresponding call in MinecraftServer
